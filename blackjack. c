#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define DECK_SIZE 52

typedef struct {
    char *suit;
    char *rank;
    int value;
} Card;

// Function to initialize the deck
void initDeck(Card *deck) {
    char *suits[] = {"♠", "♥", "♦", "♣"};
    char *ranks[] = {"A","2","3","4","5","6","7","8","9","10","J","Q","K"};
    int values[] = {11,2,3,4,5,6,7,8,9,10,10,10,10};
    
    int i, j, k = 0;
    for(i = 0; i < 4; i++) {
        for(j = 0; j < 13; j++) {
            deck[k].suit = suits[i];
            deck[k].rank = ranks[j];
            deck[k].value = values[j];
            k++;
        }
    }
}

// Function to shuffle the deck
void shuffleDeck(Card *deck) {
    srand(time(NULL));
    for(int i = 0; i < DECK_SIZE; i++) {
        int r = rand() % DECK_SIZE;
        Card temp = deck[i];
        deck[i] = deck[r];
        deck[r] = temp;
    }
}

// Function to calculate hand total
int handTotal(Card *hand, int cardsCount) {
    int total = 0, aces = 0;
    for(int i = 0; i < cardsCount; i++) {
        total += hand[i].value;
        if(hand[i].value == 11) aces++;
    }
    while(total > 21 && aces > 0) {
        total -= 10;
        aces--;
    }
    return total;
}

// Function to display hand with ASCII cards
void displayHand(char *name, Card *hand, int cardsCount, int hideFirst) {
    printf("%s:\n", name);
    for(int i = 0; i < cardsCount; i++) {
        if(i == 0 && hideFirst) {
            printf("[??] ");
        } else {
            printf("[%2s%s] ", hand[i].rank, hand[i].suit);
        }
    }
    if(!hideFirst) printf("  Total: %d", handTotal(hand, cardsCount));
    printf("\n\n");
}

int main() {
    Card deck[DECK_SIZE];
    initDeck(deck);
    shuffleDeck(deck);
    
    Card playerHand[10];
    Card dealerHand[10];
    int playerCards = 0, dealerCards = 0;
    
    // Deal initial cards
    playerHand[playerCards++] = deck[0];
    dealerHand[dealerCards++] = deck[1];
    playerHand[playerCards++] = deck[2];
    dealerHand[dealerCards++] = deck[3];
    
    int deckIndex = 4;
    char choice[10];
    
    while(1) {
        displayHand("Dealer", dealerHand, dealerCards, 1);
        displayHand("Player", playerHand, playerCards, 0);
        
        if(handTotal(playerHand, playerCards) == 21) {
            printf("Blackjack! You win!\n");
            return 0;
        }
        
        printf("Hit or Stand? (h/s): ");
        scanf("%s", choice);
        
        if(choice[0] == 'h' || choice[0] == 'H') {
            playerHand[playerCards++] = deck[deckIndex++];
            if(handTotal(playerHand, playerCards) > 21) {
                displayHand("Player", playerHand, playerCards, 0);
                printf("Bust! You lose.\n");
                return 0;
            }
        } else {
            break;
        }
    }
    
    // Dealer's turn
    while(handTotal(dealerHand, dealerCards) < 17) {
        dealerHand[dealerCards++] = deck[deckIndex++];
    }
    
    displayHand("Dealer", dealerHand, dealerCards, 0);
    displayHand("Player", playerHand, playerCards, 0);
    
    int playerTotal = handTotal(playerHand, playerCards);
    int dealerTotal = handTotal(dealerHand, dealerCards);
    
    if(dealerTotal > 21 || playerTotal > dealerTotal) {
        printf("You win!\n");
    } else if(playerTotal < dealerTotal) {
        printf("You lose.\n");
    } else {
        printf("Push (Tie)!\n");
    }
    
    return 0;
}
